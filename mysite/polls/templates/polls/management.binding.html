{% extends "polls/base.html" %}
{% load static %}

{% block title %}Management Page - Binding{% endblock %}

{% block content %}
<h3>New questions:</h3>
<ul>
	<div id="updating-part">
	{% include "polls/management.update.html" with new_questions=new_questions %}
	</div>
</ul>
{% endblock %}

{% block script %}
<script src="{% static '/polls/js/jquery-3.2.1.min.js' %}"></script>
<script>
	var socket = new WebSocket("ws://" + window.location.host + "/management/binding/");
	socket.onopen = function open() {
		console.log("Created WebSocket connection.");
	}
	socket.onmessage = function message(event) {
		var data = JSON.parse(event.data);
		var question_id = data.payload.pk;
		var question_text = data.payload.data.question_text;
		if (data.payload.action == 'create') {
			$('ul').prepend(('<li data-question="' + question_id + '">' + question_text + '</li>'));
		} else if (data.payload.action == 'update') {
			var question = $('li').filter(function ( question ) {
				return $(this).data('question') == question_id;
			});
			question.html(question_text);
		} else if (data.payload.action == 'delete') {
			var question = $('li').filter(function ( question ) {
				return $(this).data('question') == question_id;
			});
			question.remove();
		};
	};
	if (socket.readyState == WebSocket.OPEN) {
		socket.onopen();
	}
</script>
{% endblock %}
